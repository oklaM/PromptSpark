# PromptSpark 产品演进路线图 & 需求规格说明书 (v2.0)

**日期:** 2025-12-24  
**状态:** 规划中  
**目标:** 从“基础提示词库”进阶为“智能化 Prompt 工程平台”  

---

## 1. 概述 (Overview)
当前 PromptSpark 已经具备了完善的 CRUD、权限管理和基础协作功能。下一阶段的战略重心将转向 **"智能化"** 与 **"工程化"**，旨在解决用户“无法验证效果”、“编写门槛高”、“迭代对比难”的三大痛点。

---

## 2. 详细需求规划 (Detailed Requirements)

### 🚀 P1: 核心差异化 - 交互式运行 (Prompt Playground)
**目标:** 让用户在不离开平台的情况下，直接运行并测试 Prompt 效果，打造 IDE 般的体验。

#### 2.1 在线运行 (Run & Test)
*   **用户故事:** 用户在 Prompt 详情页，可以输入测试变量，点击“运行”，实时查看大模型的输出结果。
*   **功能点:**
    *   **API Key 管理:** 用户可在个人设置或环境变量中配置 OpenAI/Anthropic/Gemini 的 API Key（前端本地存储或后端加密存储）。
    *   **参数配置:** 提供 Temperature, Max Tokens, Top P 等常见参数调节面板。
    *   **流式输出:** 支持 Server-Sent Events (SSE)，实现打字机效果的实时响应。
*   **技术依赖:** 扩展后端 `aiService.ts`，实现通用的 LLM 调用接口。

#### 2.2 变量自动识别 (Variable Support)
*   **用户故事:** 当 Prompt 中包含 `{{product_name}}` 等占位符时，系统自动识别并生成对应的输入表单。
*   **功能点:**
    *   正则匹配 `{{variable}}` 语法。
    *   动态生成 Input/Textarea 表单供用户填入测试值。
    *   发送请求前自动进行字符串替换。

#### 2.3 模型竞技场 (Model Arena)
*   **用户故事:** 用户想知道 GPT-4 和 Claude-3 哪个处理这个任务更好。
*   **功能点:**
    *   分屏显示（Split View）。
    *   同时向两个不同的模型发送相同的 Prompt。
    *   并在同一视图下对比输出结果。

---

### ✨ P2: 智能化辅助 - AI Copilot
**目标:** 降低编写门槛，利用 AI 能力提升平台内容的整体质量。这是目前的 **Quick Win**。

#### 2.1 智能润色 (Smart Refine)
*   **用户故事:** 用户写了一个简单的指令“写个文案”，点击“AI 优化”，系统自动扩写为包含角色设定、背景、任务、约束的结构化 Prompt。
*   **功能点:**
    *   在创建/编辑模态框中增加“✨ AI 优化”按钮。
    *   后端调用 LLM，使用内置的高质量 Meta-Prompt 对用户输入进行重写。
    *   支持“保留原意”或“创意扩写”两种模式。

#### 2.2 评分与诊断 (Analysis & Scoring)
*   **用户故事:** 用户保存前，想知道这个 Prompt 是否足够清晰。
*   **功能点:**
    *   静态分析：检查长度、变量完整性。
    *   AI 诊断：分析清晰度、安全性、逻辑漏洞，并给出 0-100 的评分及改进建议。

#### 2.3 自动打标 (Auto-Tagging)
*   **用户故事:** 用户懒得手动填标签，希望系统自动分类。
*   **功能点:**
    *   基于 Prompt 内容，AI 自动推荐 3-5 个相关标签（如：#代码生成 #营销 #Python）。
    *   **API 设计 (草稿):** `POST /api/ai/analyze` -> `{ content }` -> Returns `{ title, description, category, tags }`。可复用于自动填充表单。

---

### 🛠️ P3: 工程化深度 - 版本对比与评测 (Engineering)
**目标:** 服务于专业 Prompt 工程师，支持严谨的迭代过程。

#### 3.1 可视化版本 Diff (Visual Diff)
*   **用户故事:** 用户回滚历史版本时，需要清楚知道 v2 和 v3 到底改了哪几个字。
*   **功能点:**
    *   引入 `diff-match-patch` 类库。
    *   在历史记录页，提供“与上一版本对比”视图，红绿高亮显示增删内容。

#### 3.2 评测记录 (Eval Logs) (未来规划)
*   **用户故事:** 记录某次运行结果的满意度，用于长期分析。
*   **功能点:**
    *   在 Playground 运行结果后，允许用户标记“Bad case”或“Good case”。
    *   统计该 Prompt 的测试通过率。

---

### 🔌 P4: 开发者生态 - 集成能力 (Integration)
**目标:** 将 PromptSpark 作为基础设施嵌入到业务流中 (Prompt-as-a-Service)。

#### 4.1 SDK / API Access
*   **用户故事:** 开发者希望在代码中直接调用最新的 Prompt，而不是硬编码在项目中。
*   **功能点:**
    *   提供只读 API: `GET /api/v1/sdk/prompts/{key}`。
    *   支持按 `tag` 或 `alias` 获取（例如获取 `prod` 环境的 Prompt）。
    *   生成 API Token 用于鉴权。

---

## 3. 技术实施路径 (Technical Roadmap)

1.  **Phase 1 (本周):** 完善后端 `aiService` 架构，支持多模型适配器模式；在前端实现“AI 优化”按钮 (P2.1)。
2.  **Phase 2 (下周):** 开发 Playground 界面，实现单模型运行测试 (P1.1)。
3.  **Phase 3:** 实现版本 Diff (P3.1) 和 SDK 基础接口 (P4.1)。

---

**备注:** 
当前 `aiService.ts` 已经包含基础结构，建议优先从 **P2.1 (智能润色)** 开始落地，因为它不需要复杂的前端交互变更，但能显著提升用户体验。
